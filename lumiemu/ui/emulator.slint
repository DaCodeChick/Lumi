import { Button, VerticalBox, HorizontalBox, ScrollView } from "std-widgets.slint";

export component MemoryViewer inherits Window {
    title: "Memory Viewer";
    preferred-width: 600px;
    preferred-height: 500px;
    
    in-out property <string> memory-text: "";
    
    VerticalBox {
        padding: 10px;
        
        Text {
            text: "NES Memory ($0000-$FFFF)";
            font-size: 14px;
            font-weight: 700;
        }
        
        ScrollView {
            vertical-stretch: 1;
            
            Text {
                text: memory-text;
                font-family: "monospace";
                font-size: 11px;
                wrap: no-wrap;
            }
        }
    }
}

export component MainWindow inherits Window {
    title: "LumiEmu - NES Emulator";
    preferred-width: 800px;
    preferred-height: 600px;
    
    in-out property <image> screen-image;
    in-out property <string> rom-path: "";
    in-out property <bool> emulator-running: false;
    in-out property <string> fps-text: "FPS: 0";
    
    callback load-rom();
    callback start-emulation();
    callback stop-emulation();
    callback key-pressed(string);
    callback key-released(string);
    callback open-memory-viewer();
    
    // Keyboard handling at window level
    forward-focus: focus-scope;
    
    focus-scope := FocusScope {
        key-pressed(event) => {
            root.key-pressed(event.text);
            return accept;
        }
        
        key-released(event) => {
            root.key-released(event.text);
            return accept;
        }
        
        VerticalBox {
            padding: 10px;
            spacing: 10px;
            
            // Menu bar
            HorizontalBox {
                spacing: 10px;
                
                Button {
                    text: "Load ROM";
                    clicked => { 
                        root.load-rom();
                    }
                }
                
                Button {
                    text: emulator-running ? "Stop" : "Start";
                    enabled: rom-path != "";
                    clicked => {
                        if (emulator-running) {
                            root.stop-emulation();
                        } else {
                            root.start-emulation();
                        }
                    }
                }
                
                Button {
                    text: "Memory Viewer";
                    enabled: rom-path != "";
                    clicked => {
                        root.open-memory-viewer();
                    }
                }
                
                Text {
                    text: rom-path != "" ? "ROM: " + rom-path : "No ROM loaded";
                    vertical-alignment: center;
                }
                
                Rectangle {
                    horizontal-stretch: 1;
                }
                
                Text {
                    text: fps-text;
                    vertical-alignment: center;
                }
            }
            
            // Emulator screen
            Rectangle {
                border-width: 2px;
                border-color: #808080;
                background: #000000;
                horizontal-stretch: 1;
                vertical-stretch: 1;
                
                Image {
                    source: screen-image;
                    width: 100%;
                    height: 100%;
                    image-fit: contain;
                }
            }
            
            // Controls info
            Text {
                text: "Controls: Arrow Keys = D-Pad | Z = A | X = B | Enter = Start | Space = Select";
                font-size: 12px;
                color: #808080;
            }
        }
    }
}
